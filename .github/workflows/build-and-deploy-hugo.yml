
# name: Deploy Hugo Site to Google Cloud Storage

# on:
#   push:

# jobs:
#   deploy_site:
#     runs-on: 'ubuntu-latest'
#     permissions:
#       contents: write
#     steps:
#       - name: Checkout repository
#         uses: 'actions/checkout@v3'

#       - name: Set up Hugo
#         uses: peaceiris/actions-hugo@v2
#         with:
#           hugo-version: 'latest'

#       - name: Build Hugo site
#         run: hugo --minify

#       - name: Authenticate to Google Cloud
#         uses: google-github-actions/auth@v1
#         with:
#           credentials_json: '${{ secrets.GOOGLE_CREDENTIALS }}'

#       - name: Upload contents to Google Cloud Storage
#         uses: google-github-actions/upload-cloud-storage@v1
#         with:
#           path: public
#           destination: krystianbucko.com
#           parent: false

name: Deploy Hugo Site to Google Cloud Storage

on:
  push:

jobs:
  deploy_site:
    runs-on: 'ubuntu-latest'
    permissions:
      contents: read
    steps:
      - name: Checkout repository
        uses: 'actions/checkout@v3'

      - name: Install Node.js and npm
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Install npm dependencies
        run: npm ci

      - name: Set up Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: 'latest'

      - name: Build Hugo site
        run: hugo --minify

      - name: Move built files to repository
        run: |
          mkdir -p public
          cp -R ./public/. $GITHUB_WORKSPACE/public/
        working-directory: ./public   # Set the working directory to "public"

      - name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v1
        with:
          credentials_json: '${{ secrets.GOOGLE_CREDENTIALS }}'

      - name: Upload contents to Google Cloud Storage
        uses: google-github-actions/upload-cloud-storage@v1
        with:
          path: public
          destination: krystianbucko.com
          parent: false

